%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Preamble

%%% Document Type
\documentclass[11pt]{article}

%%% Packages
\usepackage{amsmath,amssymb,cancel,units} % math environment and symbols
\usepackage{array}                        % for better arrays (eg matrices) in maths
\usepackage{paralist}                     % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim}                     % adds environment for commenting out blocks of text & for better verbatim
\usepackage[pdftex,bookmarks,colorlinks,breaklinks]{hyperref}  % PDF hyperlinks, with coloured links
\usepackage{memhfixc}                     % remove conflict between the memoir class & hyperref
\usepackage{graphicx}                     % Add graphics capabilities
\usepackage{xspace}                        % smart space insertion after commands
\usepackage{tabulary}
\usepackage[table]{xcolor} % http://tex.stackexchange.com/questions/5363/how-to-create-alternating-rows-in-a-table

%%% Notation and Variables
\newcommand{\hostTreeSamples}{\mathcal{T}}
\newcommand{\sourceHostTree}{\bar{T}}
\newcommand{\augmentedHostTreeSamples}{\mathbf{T}^{*}}
\newcommand{\simulationTime}{\tau}
\newcommand{\hostEvent}{\eta}
\newcommand{\hostEventSchedule}{\mathcal{H}}
\newcommand{\hostEventScheduleSamples}{\mathbb{H}}
\newcommand{\symbiontTree}{\psi}
\newcommand{\scaledSymbiontTree}{\psi\prime}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Main Document
\begin{document}
% \rowcolors{2}{gray!25}{gray!15}

\title{INPHEST Development Journal}
\maketitle

\section{Simulation of Summary Statistics}

\begin{enumerate}
    \item Generate source host tree $\sourceHostTree$.
    \begin{description}
        \item[Inputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item Sequence data.
                    \item Divergence time calibration priors.
                \end{compactitem}
            \end{minipage}
        \item[Outputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item $\sourceHostTree$: time-calibrated phylogeny.
                \end{compactitem}
            \end{minipage}
        \item[Procedure]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item Use \texttt{BEAST} to generate sample from the posterior distribution of trees given the data, $\hostTreeSamples$.
                    \item Summarize $\hostTreeSamples$ using MCCT or other criteria to produce $\sourceHostTree$.
                \end{compactitem}
            \end{minipage}
    \end{description}

    % \item Generate samples of augmented host trees, $\augmentedHostTreeSamples$, conditioned on source host tree, $\sourceHostTree$.
    \item Generate samples of biogeographical history augmented host trees, $\augmentedHostTreeSamples$.
    \begin{description}
        \item[Inputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item $\sourceHostTree$: time-calibrated phylogeny.
                    \item Labeling of tips on $\sourceHostTree$ by geography (distributional range, specified as presence/absence over set of areas, for each tip).
                \end{compactitem}
            \end{minipage}
        \item[Outputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item $\augmentedHostTreeSamples$: samples of host tree augmented with biogeographical history.
                \end{compactitem}
            \end{minipage}
        \item[Procedure]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item Use \texttt{BayArea} or \texttt{RevBayes} to generate stochastic mapped samples.
                \end{compactitem}
            \end{minipage}
    \end{description}

    \item Generate samples of schedule of host events, $\hostEventScheduleSamples$.
    \begin{description}
        \item[Inputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item $\augmentedHostTreeSamples$: samples of host tree augmented with biogeographical history.
                \end{compactitem}
            \end{minipage}
        \item[Outputs]  \hfill \\
            \begin{minipage}[t]{\linewidth}
                \begin{compactitem}
                    \item $\hostEventScheduleSamples$: samples of a schedule of host events, where each distinct element $\hostEventSchedule_i, \hostEventSchedule_i \in \hostEventScheduleSamples$ bijectively corresponds to a distinct tree from $\augmentedHostTreeSamples$, and consists of a vector of ordered pairs of $(\simulationTime, \hostEvent)$, where $\simulationTime$ is the simulation time of an event and $\hostEvent$ is the event (host speciation, host extinction, host dispersal, etc.) that occurs at that time on the particular tree to which it corresponds.
                \end{compactitem}
            \end{minipage}
    \end{description}

    \item For \textit{each} simulation replicate:
    \begin{enumerate}
        \item Sample a schedule of host tree events, $\hostEventSchedule_i$, from $\hostEventScheduleSamples$.
        \item Simulate symbiont tree, $\symbiontTree$, conditioned on $\hostEventSchedule$ and other parameters.
        % \item Scale symbiont tree by each substitution rate scaling factor to yield scaled symbiont tree $\scaledSymbiontTree$.
        % \item Calculate summary statistics on scaled symbiont tree, $\scaledSymbiontTree$.
        \item Calculate summary statistics on the symbiont tree, $\symbiontTree$.
    \end{enumerate}

\end{enumerate}

\section{Event Dynamics}
\begin{description}
    \item[Host lineage speciation]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Daughter host lineages inherit parent symbiont load:
                    \begin{compactitem}
                        \item Both host daughters inherit full symbiont load of parent?
                        \item Some other scheme?
                    \end{compactitem}
            \end{compactitem}
        \end{minipage}
    \item[Host lineage extinction]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Symbiont lineages loses host. If this results in any symbiont lineage host set being reduced to the null set, the symbiont lineage goes extinct.
            \end{compactitem}
        \end{minipage}
    \item[Host lineage area gain]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
            \item No action (passive area gain by proxy by symbiont lineages associated with this host).
            \end{compactitem}
        \end{minipage}
    \item[Host lineage area loss]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
            \item If host lineage does not go extinct (host lineage range not reduced to the null set): no action (passive area loss by proxy by symbiont lineages associated with this host).
            \item If host lineage goes extinct (host lineage range reduced to the null set): as with host lineage extinction (above).
            \end{compactitem}
        \end{minipage}
    \item[Symbiont lineage speciation]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Daughter symbiont lineages inherit parent host set pseudo-allopatrically: one daughter lineage inherits one host, other inherit remaining.
                \item Daughter symbiont lineages inherit parent host set pseudo-subset-sympatrically: one daughter lineage inherits one host, other inherits entire host set.
                \item Daughter symbiont lineages inherit parent host set by random sampling with replacement.
                \item Daughter symbiont lineages partition parent host set (randomly).
            \end{compactitem}
        \end{minipage}
    \item[Symbiont lineage extinction]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Symbiont lineage removed from tree.
            \end{compactitem}
        \end{minipage}
    \item[Symbiont lineage host gain]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Symbiont lineage gains host.
                \item Note: potential (new) hosts restricted to hosts that share one or more biogeographical areas with a current host.
            \end{compactitem}
        \end{minipage}
    \item[Symbiont lineage host loss]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Symbiont lineage loses host, going extinct if host set reduced to the null set.
            \end{compactitem}
        \end{minipage}
    \item[Symbiont lineage host jumping]  \hfill \\
        \begin{minipage}[t]{\linewidth}
            \begin{compactitem}
                \item Symbiont lineage gains host.
                \item Note: potential (new) hosts restricted to hosts that share one or more biogeographical areas with a current host.
            \end{compactitem}
        \end{minipage}
\end{description}

\section{Questions/Issues}
\begin{itemize}
    \item   Events on the very long edge subtending root: ignored. Parasite simulation begins at root node.
    \item   How to determine initial symbiont lineage host and geographic affinities? See \verb+model.Phylogeny.seed_symbiont_distribution_matrix()+.
    \item   Anagenetic host gain: Are we modeling this as host switching or host addition?
    \item   Anagenetic host gain: Is probability of host gain sum of probability of ``dispersing'' to new host from existing hosts, or is rate of host gain absolute (i.e., independent of the number of hosts already occupied)?
    \item   Anagenetic host gain: Need to separately model host availability/gain in each area?

\end{itemize}

\section{Tests Required}
\begin{itemize}
    \item Parsing of BayAreas file.
    \item Correct construction of  host regime event schedule.

\end{itemize}

\end{document}
